# トラブルシューティング

Marpを使用中に発生する可能性のある問題と、その解決方法をまとめています。

---

## 🔍 問題の診断フロー

問題が発生したら、以下の順序で確認してください：

```
1. Markdownの文法は正しいか？
   ↓
2. Marp拡張機能は有効か？
   ↓
3. テーマファイルのパスは正しいか？
   ↓
4. Node.js / Marp CLIは正しくインストールされているか？
   ↓
5. エラーメッセージを確認
```

---

## 🐛 よくあるエラーと解決方法

### エラー1：プレビューが表示されない

#### 症状
VS Codeでプレビューアイコンをクリックしても、何も表示されない

#### 原因と解決方法

**原因1：`marp: true` が書かれていない**

✅ 解決方法：
ファイルの最初に以下を追加
```markdown
---
marp: true
---
```

---

**原因2：Marp拡張機能が無効になっている**

✅ 解決方法：
1. VS Codeの拡張機能パネルを開く（`Ctrl + Shift + X`）
2. 「Marp for VS Code」を検索
3. 「有効にする」をクリック
4. VS Codeを再起動

---

**原因3：ファイルが`.md`拡張子で保存されていない**

✅ 解決方法：
1. メニュー → ファイル → 名前を付けて保存
2. ファイル名の末尾に `.md` を追加
3. 例：`presentation.md`

---

### エラー2：スライドが1枚にまとまってしまう

#### 症状
複数のスライドを作ったつもりが、すべて1枚のスライドに表示される

#### 原因と解決方法

**区切り線の書き方が間違っている**

❌ 間違い：
```markdown
--
または
----
```

✅ 正しい：
```markdown
---
```
（ハイフン3つだけ）

---

### エラー3：テーマが適用されない

#### 症状
カスタムテーマを指定しても、デフォルトのデザインが表示される

#### 原因と解決方法

**原因1：テーマ名が一致していない**

✅ 解決方法：
CSSファイル内の `@theme` とMarkdownファイルの `theme:` を一致させる

**CSSファイル（corporate-blue.css）**
```css
/* @theme corporate-blue */
```

**Markdownファイル**
```markdown
---
marp: true
theme: corporate-blue
---
```

---

**原因2：Marp CLIでテーマパスが指定されていない**

✅ 解決方法：
コマンド実行時に `--theme` オプションでパスを指定

```bash
marp --pptx --theme themes/corporate-blue.css input.md -o output.pptx
```

---

**原因3：CSSファイルにシンタックスエラーがある**

✅ 解決方法：
1. CSSファイルを開く
2. 波括弧 `{}` やセミコロン `;` が正しく閉じられているか確認
3. コピー＆ペースト時の文字化けがないか確認

---

### エラー4：PowerPointファイルが生成されない

#### 症状
Marp CLIを実行してもPPTXファイルが作成されない

#### 原因と解決方法

**原因1：`--pptx` オプションが指定されていない**

❌ 間違い：
```bash
marp input.md -o output.pptx
```

✅ 正しい：
```bash
marp --pptx input.md -o output.pptx
```

---

**原因2：出力先フォルダが存在しない**

✅ 解決方法：
先にフォルダを作成

```bash
# outputフォルダを作成
mkdir output

# その後、生成コマンドを実行
marp --pptx input.md -o output/presentation.pptx
```

---

**原因3：ファイルパスに日本語が含まれている**

✅ 解決方法：
日本語を含まないパスを使用

❌ 間違い：
```bash
marp --pptx 提案資料.md -o 出力/プレゼン.pptx
```

✅ 正しい：
```bash
marp --pptx proposal.md -o output/presentation.pptx
```

---

### エラー5：`marp: command not found`

#### 症状
コマンドプロンプトで `marp` コマンドを実行すると、「コマンドが見つかりません」と表示される

#### 原因と解決方法

**原因1：Marp CLIがインストールされていない**

✅ 解決方法：
Marp CLIをインストール

```bash
npm install -g @marp-team/marp-cli
```

---

**原因2：Node.jsがインストールされていない**

✅ 解決方法：
1. Node.js公式サイトからダウンロード：https://nodejs.org/ja/
2. インストール後、コマンドプロンプトを再起動
3. 確認：
```bash
node -v
npm -v
```

---

**原因3：インストール後にコマンドプロンプトを再起動していない**

✅ 解決方法：
1. コマンドプロンプトを閉じる
2. もう一度開く
3. `marp --version` で確認

---

### エラー6：表（テーブル）が崩れる

#### 症状
Markdownで表を作成したが、レイアウトが崩れている

#### 原因と解決方法

**列の区切り記号 `|` がずれている**

❌ 間違い：
```markdown
| 列1 | 列2 |
|-----|-----|
| データ1 | データ2 | データ3 |
```

✅ 正しい：
```markdown
| 列1 | 列2 | 列3 |
|-----|-----|-----|
| データ1 | データ2 | データ3 |
```

**すべての行で `|` の数を揃える**

---

### エラー7：日本語が文字化けする

#### 症状
生成されたPowerPointで日本語が正しく表示されない

#### 原因と解決方法

**ファイルのエンコーディングがUTF-8でない**

✅ 解決方法（VS Code）：
1. VS Code画面右下の「エンコーディング」をクリック
2. 「UTF-8で保存」を選択
3. ファイルを保存し直す

---

### エラー8：画像が表示されない

#### 症状
Markdownに画像を埋め込んだが、スライドに表示されない

#### 原因と解決方法

**原因1：画像パスが間違っている**

✅ 解決方法：
相対パスまたは絶対パスを正しく指定

```markdown
<!-- 相対パス -->
![](./images/logo.png)

<!-- または絶対パス -->
![](C:/Users/YourName/images/logo.png)
```

---

**原因2：画像ファイルが存在しない場所を指定している**

✅ 解決方法：
1. エクスプローラーで画像ファイルの場所を確認
2. 正しいパスをコピー
3. Markdownに貼り付け

---

### エラー9：フォントが適用されない

#### 症状
CSSでフォントを指定したが、スライドに反映されない

#### 原因と解決方法

**指定したフォントがシステムにインストールされていない**

✅ 解決方法：
フォールバック（代替フォント）を複数指定

```css
section {
  font-family: 'Yu Gothic', 'Meiryo', 'MS PGothic', sans-serif;
}
```

---

### エラー10：Chromiumのダウンロードが進まない

#### 症状
Marp CLIの初回実行時、Chromiumのダウンロードが途中で止まる

#### 原因と解決方法

**ネットワーク接続の問題、またはファイアウォールによるブロック**

✅ 解決方法1：再実行
```bash
marp --pptx input.md -o output.pptx
```

✅ 解決方法2：手動でChromiumをダウンロード
```bash
# 環境変数を設定してChromiumをスキップ
set PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true

# Marpを再インストール
npm uninstall -g @marp-team/marp-cli
npm install -g @marp-team/marp-cli
```

---

## 🔧 高度なトラブルシューティング

### PDFは生成できるが、PPTXが生成できない

#### 原因
Puppeteer（ブラウザエンジン）の問題

#### 解決方法
1. **Node.jsを最新版にアップデート**
```bash
node -v
# バージョンが古い場合、公式サイトから最新版をダウンロード
```

2. **Marp CLIを再インストール**
```bash
npm uninstall -g @marp-team/marp-cli
npm install -g @marp-team/marp-cli
```

3. **キャッシュをクリア**
```bash
npm cache clean --force
```

---

### VS Code拡張機能が動作しない

#### 原因
拡張機能のバージョン不整合、またはVS Codeの問題

#### 解決方法
1. **VS Codeを最新版にアップデート**
   - メニュー → ヘルプ → 更新プログラムの確認

2. **拡張機能を再インストール**
   - 拡張機能パネルで「Marp for VS Code」をアンインストール
   - VS Codeを再起動
   - 再度インストール

3. **設定をリセット**
   - VS Codeのコマンドパレット（`Ctrl + Shift + P`）
   - 「Preferences: Open User Settings (JSON)」を選択
   - Marp関連の設定を削除

---

## 📞 サポートが必要な場合

### 公式リソース

1. **Marp公式ドキュメント**
   - https://marp.app/
   - https://marpit.marp.app/

2. **GitHub Issues**
   - Marp for VS Code：https://github.com/marp-team/marp-vscode/issues
   - Marp CLI：https://github.com/marp-team/marp-cli/issues

3. **Stack Overflow**
   - タグ：`[marp]` で検索

---

### プロジェクトのサポート

本プロジェクトに関する質問・バグ報告：
- GitHub Issuesで受付予定（プロジェクト公開後）

---

## ✅ 問題解決チェックリスト

問題が発生したら、以下を順番に確認してください：

### 基本確認
- [ ] Markdownファイルの先頭に `---marp: true---` がある
- [ ] スライドの区切りは `---`（ハイフン3つ）
- [ ] ファイルは `.md` 拡張子で保存されている
- [ ] ファイルのエンコーディングはUTF-8

### VS Code拡張機能
- [ ] Marp for VS Codeがインストールされている
- [ ] 拡張機能が有効になっている
- [ ] VS Codeを再起動してみた

### Marp CLI
- [ ] Node.jsがインストールされている（`node -v`で確認）
- [ ] Marp CLIがインストールされている（`marp --version`で確認）
- [ ] コマンドプロンプトを再起動した

### テーマ関連
- [ ] CSSファイルの `@theme` とMarkdownの `theme:` が一致
- [ ] テーマファイルのパスが正しい
- [ ] CSSファイルにシンタックスエラーがない

### ファイル出力
- [ ] 出力先フォルダが存在する
- [ ] ファイルパスに日本語が含まれていない
- [ ] `--pptx` オプションを指定している（PPTX生成時）

---

## 🎯 まとめ

トラブルシューティングガイドは以上です。問題が解決しない場合は、エラーメッセージをコピーして、GitHub Issuesまたは公式ドキュメントで検索してみてください。

---

**これですべてのドキュメントが揃いました！**

➡️ **プロジェクトをGitHubに公開する準備が整いました**